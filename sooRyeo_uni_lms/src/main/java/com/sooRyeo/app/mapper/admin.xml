<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<!-- ==== #29. 루트 엘리먼트 & 네임스페이스 설정(프로젝트 전체내에서 유일해야 한다.) ==== -->
<mapper namespace="admin">

	<select id="selectAdmin" resultType="com.sooRyeo.app.domain.Admin" parameterType="com.sooRyeo.app.dto.LoginDTO">  <!-- VO에 있는 필드명과 select 해온 컬럼명은 같아야한다!! -->
		SELECT * 
		FROM tbl_admin 
		WHERE admin_id = #{id} AND pwd = #{password}
				
	</select>

	<select id="departmentList_select" resultType="com.sooRyeo.app.domain.Department">  <!-- VO에 있는 필드명과 select 해온 컬럼명은 같아야한다!! -->
		SELECT *
		FROM tbl_department 
	</select>

	<insert id="memberRegister_end" parameterType="com.sooRyeo.app.dto.RegisterDTO">
		<if test="fk_department_seq == null">
			INSERT INTO tbl_professor (prof_id, pwd, name, jubun, tel, office_address, email, employment_date, employment_stat, department_seq, img_name)
			VALUES (generate_professor_id(), #{pwd}, #{name}, #{jubun}, #{tel}, #{office_address}, #{email}, sysdate, default, #{department_seq}, #{img_name})
		</if>
		<if test="department_seq == null">
			INSERT INTO tbl_student (student_id, pwd, name, jubun, tel, grade, address, postcode, detailaddress, extraaddress, email, register_year, status, fk_department_seq, img_name)
			VALUES (generate_student_id(), #{pwd}, #{name}, #{jubun}, #{tel}, #{grade}, #{address}, #{postcode}, #{detailaddress}, #{extraAddress}, #{email}, #{register_year}, default, #{fk_department_seq}, #{img_name})
		</if>
	</insert>

	<select id="emailDuplicateCheck" parameterType="String" resultType="String">  <!-- VO에 있는 필드명과 select 해온 컬럼명은 같아야한다!! -->
		SELECT email
		FROM tbl_student
		where email = #{email}
	</select>
	
	<select id="getAnnouncement" parameterType="com.sooRyeo.app.domain.Announcement" resultType="com.sooRyeo.app.domain.Announcement">  <!-- VO에 있는 필드명과 select 해온 컬럼명은 같아야한다!! -->
		select *
		from
		(
			SELECT rownum as rno, announcement_seq, a_title, writeday, viewcount
			FROM tbl_announcement
		)V
		where V.rno BETWEEN #{startRno} AND #{endRno}
	</select>
	
	<select id="getTotalElementCount" resultType="Integer">
		SELECT count(*)
		FROM tbl_announcement
	</select>
	
	<update id="increase_readCount" parameterType="String">
		update tbl_announcement set viewCount = viewCount + 1
		where announcement_seq = #{seq}
	</update>
	
	<select id="getView" parameterType="HashMap" resultType="com.sooRyeo.app.domain.Announcement">
		SELECT previousseq, previoussubject, seq, subject, content
		     , readCount, regDate
		     , nextseq, nextsubject
		     , fileName
	    from
	    (
	    select lag (seq) over(order by seq desc) AS previousseq 
	         , lag (subject,1) over(order by seq desc) AS previoussubject
	         , seq
	         , lead (seq) over(order by seq desc) AS nextseq
	         , lead (subject, 1) over(order by seq desc) AS Nextsubject
	         , fileName
	    from tbl_board
	    where status = 1
		<if test='searchWord != ""'>
		    and lower(subject) like '%'||lower(#{searchWord})||'%'
		</if>
	    ) V
	    WHERE V.seq = #{seq}
	</select>
	
</mapper>