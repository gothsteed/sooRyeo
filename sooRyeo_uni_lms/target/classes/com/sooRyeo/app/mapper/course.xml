<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="course">


	<resultMap id="CourseJoinCurriculum" type="com.sooRyeo.app.domain.Course">
		<id property="course_seq" column="course_seq" />
		<result property="fk_professor_id" column="fk_professor_id" />
		<result property="fk_curriculum_seq" column="fk_curriculum_seq" />
		<result property="fk_time_seq" column="fk_time_seq" />
		<result property="capacity" column="capacity" />
		<result property="semester_date" column="semester_date" />
		<association property="curriculum" javaType="com.sooRyeo.app.domain.Curriculum">
			<id property="curriculum_seq" column="curriculum_seq" />
			<result property="fk_department_seq" column="fk_department_seq" />
			<result property="grade" column="grade" />
			<result property="name" column="name" />
			<result property="credit" column="credit" />
			<result property="required" column="required" />
		</association>
	</resultMap>





	<insert id="getStudentCourseList">


	</insert>

	<insert id="registerCourse" parameterType="HashMap">

	</insert>


	<insert id="openCourse" parameterType="HashMap">
		<selectKey keyProperty="course_seq" resultType="int" order="BEFORE">
			SELECT course_seq.nextval FROM dual
		</selectKey>
		INSERT INTO
		tbl_course (course_seq, fk_professor_id, fk_curriculum_seq, capacity, semester_date)
		VALUES (#{course_seq}, #{fk_professor_id}, #{fk_curriculum_seq}, #{capacity}, TO_DATE(to_char(sysdate), 'YYYY-MM-DD'))
	</insert>



	<insert id="insertCourseTime" parameterType="HashMap">
		INSERT INTO tbl_time (time_seq, fk_course_seq, day_of_week, start_period, end_period)
		VALUES (time_seq.nextval, #{fk_course_seq}, #{day_of_week}, #{start_period}, #{end_period})
	</insert>

	<select id="getProfCourseList" parameterType="int" resultMap="CourseJoinCurriculum">
		select *
		from
		tbl_course v1
		join
		tbl_curriculum v2
		on v1.fk_curriculum_seq = v2.curriculum_seq
		where v1.FK_PROFESSOR_ID= ${prof_id} and v1.exist = 1
	</select>


	<select id="getCourseTimes" parameterType="int" resultType="com.sooRyeo.app.domain.Time">
		select *
		from tbl_time
		where fk_course_seq = ${course_seq}
	</select>
	
	
	<update id="updateToDelete" parameterType="int">
		UPDATE tbl_course
		SET exist = 0
		where course_seq = #{course_seq}
	</update>




</mapper>